# 动态内存分配

## malloc
- 为什么malloc需要指定大小，free不需要?
当调用malloc(size)时，实际分配的内存大小大于size字节，这是因为在分配的内存区域头部有类似于
```c++
struct control_block {    
    unsigned size;
    int used;
};
```
这样的一个结构，如果malloc函数内部得到的内存区域的首地址为void *p,
那么它返回给你的就是p + sizeof(control_block)，而调用free(p)的时候，该函数把p-sizeof(control_block)，然后就可以根据((control_blcok*)p)->size得到要释放的内存区域的大小。

这也就是为什么free只能用来释放malloc分配的内存，如果用于释放其他的内存，会发生未知的错误。
## new


## new vs malloc

| **特征**                 | **new/delete**  | **mallco/free**    |
| ------------------------ | --------------- | ------------------ |
| **分配内存的位置**       | 自由存储区      | 堆                 |
| **内存分配成功的返回值** | 对象指针        | void指针           |
| **内存分配失败的返回值** | 抛出异常        | NULL               |
| **分配内存的大小**       | 编辑器计算      | 显式指定           |
| **处理数组**             | new[] /delete[] | 计算长度后显式指定 |
| **已分配内存的扩充**     | 不能            | relloc             |
| **是否相互调用**         | 可以            | 不能               |
| **分配内存时内存不足**   |                 |                    |
| **函数重载**             | 允许            | 不允许             |
| **构造函数与析构函数**   | 调用            | 不调用             |

